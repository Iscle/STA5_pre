/*
 * Copyright (C) 2016 STMicroelectronics
 * Author: Jean-Nicolas Graux <jean-nicolas.graux@st.com>
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2, as
 * published by the Free Software Foundation.
 */

/dts-v1/;
#include "sta1195.dtsi"
#include "ste-nomadik-pinctrl.dtsi"
#include "sta1295-audio.dtsi"

/ {
	model = "ST TELEMACO3 STA1195 EValuation Board";
	compatible = "st,sta1195";

	chosen {
		bootargs = "console=ttyAMA2,115200n8 root=/dev/mmcblk0p1
		rw rootwait earlyprintk";

	};

	soc {
		can0: c_can@40010000 {
			pinctrl-names = "default";
			pinctrl-0 = <&can0_default_mux>;
			status = "disabled";
		};

		can1: m_can@50183000 {
			pinctrl-names = "default";
			pinctrl-0 = <&can1_default_mux>;
		};

		can2: m_can@50183400 {
			pinctrl-names = "default";
			pinctrl-0 = <&can2_default_mux>;
		};

		ethernet0: dwmac@500a0000 {
			pinctrl-names = "default";
			pinctrl-0 = <&eth_default_mux>;
			snps,reset-gpio = <&gpio1 3 0>;
			snps,reset-active-low;
			snps,reset-delays-us = <100 100 100>;
			phy-mode = "rgmii";
			mac-address = [00 00 00 00 00 00];  /* Filled by U-boot */
			rxc-skew-ps = <1500>;
			txd1-skew-ps = <1320>;
		};

		fsmc: flash@80000000 {
			pinctrl-names = "default";
			pinctrl-0 = <&fsmc_default_mux>;
		};

		i2c0: i2c@50160000 {
			pinctrl-names = "default";
			pinctrl-0 = <&i2c0_default_mux>;
		};

		i2c1: i2c@50040000 {
			pinctrl-names = "default";
			pinctrl-0 = <&i2c1_default_mux>;
		};

		i2c2: i2c@50030000 {
			pinctrl-names = "default";
			pinctrl-0 = <&i2c2_default_mux>;
		};

		msp0: msp@48000000 {
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&i2s0_default_mux>;
			pinctrl-1 = <&i2s0_default_mux>;
			i2s {
				/* GCR */
				tx-clk-pol = "falling";
				rx-clk-pol = "rising";
				tx-fsync-sel = "master";
				rx-fsync-sel = "master";
				tx-clk-sel = "master";
				rx-clk-sel = "master";
				/* TCF */
				tx-elem-len-1 = <32>;
				tx-frame-len-1 = <1>;
				tx-data-delay = <1>;
				/* RCF */
				rx-elem-len-1 = <16>;
				rx-frame-len-1 = <1>;
				rx-data-delay = <1>;
			};
		};

		prm {
			st,do_poweroff_on_sby;
		};

		sdi0: sdi@50080000 {
			pinctrl-names = "default";
			pinctrl-0 = <&sdi0_default_mux>;
		};

		sdi1: sdi@50070000 {
			pinctrl-names = "default";
			pinctrl-0 = <&sdi1_default_mux>;
			bus-width = <4>;
			max-frequency = <50000000>;
			st,sig-pin-fbclk;
			st,fbclk-inverted;
			broken-cd;
		};

		qspi0: sqi@50200000 {
			status = "okay";
			pinctrl-names = "default";
			pinctrl-0 = <&sqi_default_mux>;

			flash0: serial-flash@0 {
				#address-cells = <1>;
				#size-cells = <1>;
				spi-max-frequency = <133000000>;
			};
		};

		sdi2: sdi@500B0000 {
			pinctrl-names = "default";
			pinctrl-0 = <&sdi2_default_mux>;
			max-frequency = <50000000>;
			st,sig-pin-fbclk;
			st,fbclk-inverted;
			broken-cd;
			/* disabled because in competition with the fsmc */
			status = "disabled";
		};

		sai1: sai@48D08C00 {
			status = "disabled";
			pinctrl-names = "default";
			pinctrl-0 = <&sai1_default_mux>;
		};

		sai2: sai@48D08C04 {
			status = "disabled";
			pinctrl-names = "default";
			pinctrl-0 = <&sai2_default_mux>;
		};

		sai3: sai@48D08C08 {
			status = "disabled";
			pinctrl-names = "default";
			pinctrl-0 = <&sai3_default_mux>;
		};

		sai4: sai@48D08C0C {
			pinctrl-names = "default";
			pinctrl-0 = <&sai4_default_mux>;
		};

		spi0: spi@50170000 {
			status = "disabled";
		};

		spi1: spi@50060000 {
			status = "disabled";
		};

		spi2: spi@50050000 {
			pinctrl-names = "default";
			pinctrl-0 = <&spi2_default_mux>;
			num-cs = <1>;
			spidev@0 {
				compatible = "st,sta662";
				spi-max-frequency = <1000000>;
				reg = <0>;
				spi-cpol;
				spi-cpha;
				pl022,hierarchy = <0>;
				pl022,interface = <0>;
				pl022,duplex = <0>;
			};
		};

		uart0: uart@50150000 {
			pinctrl-names = "default";
			pinctrl-0 = <&uart0_default_mux>;
		};

		uart1: uart@50000000 {
			pinctrl-names = "default";
			pinctrl-0 = <&uart1_default_mux>;
		};

		uart2: uart@50010000 {
			status = "disabled";
		};

		uart3: uart@50020000 {
			pinctrl-names = "default";
			pinctrl-0 = <&uart3_default_mux>;
		};

		usb0: usb@48400000 {
			st,vbus_sensing_gadget;
			st,vbus_raw_limit = <0x300>;
			io-channels = <&saradc 4>;
		};

		usb1: usb@48500000 {
			st,vbus_sensing_gadget;
			st,vbus_raw_limit = <0x300>;
			io-channels = <&saradc 5>;
		};

		usbphy: usb-phy@48440000 {
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&drvvbus_default_mux>;
			pinctrl-1 = <&drvvbus_default_mux>;
			st,usb0_mode = "HOST";
			st,usb1_mode = "DEVICE";
			st,usb1_cdp;
		};

		pinctrl {
			can0 {
				can0_default_mux: can_mux {
					default_mux {
						function = "can0";
						groups = "can0_a_1";
					};
				};
			};
			can1 {
				can1_default_mux: can_mux {
					default_mux {
						function = "can1";
						groups = "can1_c_1";
					};
				};
			};
			can2 {
				can2_default_mux: can_mux {
					default_mux {
						function = "can2";
						groups = "can2_c_1";
					};
				};
			};
			eth {
				eth_default_mux: eth_mux {
					default_mux {
						function = "eth";
						groups = "ethmdio_a_1",
							"ethmdc_a_1",
							"ethrmii_a_1",
							/* Rx Clock for RMII & RGMII */
							"ethmiirxclk_b_1",
							/* Tx Clock for RGMII */
							"ethmiitxclk_a_1",
							"ethmii_a_1";
					};
				};
			};
			fsmc {
				fsmc_default_mux: fsmc_mux {
					default_mux {
						function = "fsmc";
						groups = "fsmcsmadq0to7_a_1",
							"fsmcwpn_a_1",
							"fsmcbusy_a_1",
							"fsmcoen_a_1",
							"fsmcwen_a_1",
							"fsmcsmad17ale_a_1",
							"fsmcsmad16cle_a_1",
							"fsmcnandcs0n_a_1";
					};
				};
			};
			i2c0 {
				i2c0_default_mux: i2c_mux {
					default_mux {
						function = "i2c0";
						groups = "i2c0_a_2";
					};
				};
			};
			i2c1 {
				i2c1_default_mux: i2c_mux {
					default_mux {
						function = "i2c1";
						groups = "i2c1_a_1";
					};
				};
			};
			i2c2 {
				i2c2_default_mux: i2c_mux {
					default_mux {
						function = "i2c2";
						groups = "i2c2_a_1";
					};
				};
			};
			i2s0 {
				i2s0_default_mux: i2s_mux {
					default_mux {
						function = "i2s0";
						groups = "i2s0_a_1",
							"i2s0tx_a_1";
					};
				};
			};
			i2s2 {
				i2s2_default_mux: i2s_mux {
					default_mux {
						function = "i2s2";
						groups = "i2s2_c_1";
					};
				};
			};
			sqi {
				sqi_default_mux: sqi_mux {
					default_mux {
						function = "sqi";
						groups = "sqi_a_1",
							"sqifdbsck_a_1";
					};
				};
			};
			sai1 {
				sai1_default_mux: sai_mux {
					default_mux {
						function = "sai1";
						groups = "sai1_a_1";
					};
				};
			};
			sai2 {
				sai2_default_mux: sai_mux {
					default_mux {
						function = "sai2";
						groups = "sai2_a_1";
					};
				};
			};
			sai3 {
				sai3_default_mux: sai_mux {
					default_mux {
						function = "sai3";
						groups = "sai3bclk_a_1",
						"sai3fs_a_1",
						"sai3rx0_a_1",
						"sai3rx1_a_1",
						"sai3rx2_a_1";
					};
				};
			};
			sai4 {
				sai4_default_mux: sai_mux {
					default_mux {
						function = "sai4";
						groups = "sai4bclk_c_1",
							"sai4fs_c_1",
							"sai4rx0_c_1",
							"sai4rx1_c_1";
					};
				};
			};
			sdi0 {
				sdi0_default_mux: sdi_mux {
					default_mux {
						function = "mc0";
						groups = "mc0fbclk_b_1";
					};
				};
			};
			sdi1 {
				sdi1_default_mux: sdi_mux {
					default_mux {
						function = "mc1";
						groups = "mc1cmd_a_1",
							"mc1clk_a_1",
							"mc1dat0_a_1",
							"mc1dat123_b_1",
							"mc1fbclk_c_1";
					};
				};
			};
			sdi2 {
				sdi2_default_mux: sdi_mux {
					default_mux {
						function = "mc2";
						groups = "mc2_b_1",
							"mc2data4to7_b_1",
							"mc2fbclk_b_1";
					};
				};
			};
			spi1 {
				spi1_default_mux: spi_mux {
					default_mux {
						function = "spi1";
						groups = "spi1_a_1";
						/* groups = "spi1ss_a_1",
							"spi1_a_1"; */
					};
				};
			};
			spi2 {
				spi2_default_mux: spi_mux {
					default_mux {
						function = "spi2";
						groups = "spi2_b_1";
						/* groups = "spi2ss_c_1",
							"spi2_b_1"; */
					};
				};
			};
			uart0 {
				uart0_default_mux: uart_mux {
					default_mux {
						function = "u0";
						groups = "u0rxtx_a_1",
							"u0rtscts_a_1";
					};
				};
			};
			uart1 {
				uart1_default_mux: uart_mux {
					default_mux {
						function = "u1";
						groups = "u1rxtx_b_1";
					};
					/*
					 *  Disable pull resistor of uart1 rx pin by default
					 *  as it may prevent initial handshake with some
					 *  remote device (like Teseo chip) to work properly.
					 */
					default_cfg {
						pins = "GPIO29";
						ste,config = <&in_nopull>;
					};
				};
			};
			uart3 {
				uart3_default_mux: uart_mux {
					default_mux {
						function = "u3";
						groups = "u3rxtx_a_1";
					};
				};
			};
			usbphy {
				drvvbus_default_mux: drvvbus_default_mux {
					default_mux {
						function = "usb";
						groups = "usb0drvvbus_b_1",
							 "usb1drvvbus_c_1";
					};
				};
			};
			wdg {
				wdg_default_mux: wdg_mux {
					default_mux {
						function = "wdg";
						groups = "wdgswrstout_a_1";
					};
				};
			};
		};
	};
};
