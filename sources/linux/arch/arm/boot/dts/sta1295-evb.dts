/*
 * Copyright (C) 2016 STMicroelectronics
 * Author: Jean-Nicolas Graux <jean-nicolas.graux@st.com>
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2, as
 * published by the Free Software Foundation.
 */

/dts-v1/;
#include "sta1295.dtsi"
#include "ste-nomadik-pinctrl.dtsi"
#include "sta1295-audio.dtsi"

/ {
	model = "ST ACCORDO5 STA1295 EValuation Board";
	compatible = "st,sta1295";

	chosen {
		bootargs = "console=ttyAMA2,115200n8 console=tty0 consoleblank=0
			root=/dev/mmcblk1p1 rootfstype=ext4 rw rootwait quiet earlyprintk
			systemd.gpt_auto=0 coherent_pool=4M";
	};

	memory {
		reg = <0xa0000000 0x33800000>;	/* 192MiB reserved for GPU
						 * 3MiB for Camera
						 * 4MiB for Splash animation
						 *  (mjpeg + dyn. alloc area)
						 * 1MiB for Splash screen
						 */
	};

	soc {
		can0: c_can@40010000 {
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&can0_default_mux>;
			pinctrl-1 = <&can0_default_mux>;
			status = "disabled";
		};

		can1: m_can@50183000 {
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&can1_default_mux>;
			pinctrl-1 = <&can1_default_mux>;
		};

		can2: m_can@50183400 {
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&can2_default_mux>;
			pinctrl-1 = <&can2_default_mux>;
		};

		dcoadc: adc-keys@481c0000 {
			status = "okay";
			key2 {
				st,adc-channel = <5>;
				st,key-code = <106>; /* Right */
			};
			key1 {
				st,adc-channel = <4>;
				st,key-code = <105>; /* Left */
			};
		};

		ethernet0: dwmac@500a0000 {
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&eth_default_mux>;
			pinctrl-1 = <&eth_default_mux>;
			snps,reset-gpio = <&gpio1 3 0>;
			snps,reset-active-low;
			snps,reset-delays-us = <100 100 100>;
			phy-mode = "rgmii";
			mac-address = [00 00 00 00 00 00];  /* Filled by U-boot */
			rxc-skew-ps = <1500>;
			txd1-skew-ps = <1320>;
		};

		fsmc: flash@80000000 {
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&fsmc_default_mux>;
			pinctrl-1 = <&fsmc_default_mux>;
		};

		gpio_m3: gpio@40008000 {
			reserved-gpios = <0x00000001>;
		};

		i2c0: i2c@50160000 {
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&i2c0_default_mux>;
			pinctrl-1 = <&i2c0_default_mux>;
			/**
			 * Embedded iPod Authentication Coprocessor 2.0C driver
			 */
			ipod: iac20@11 {
				compatible= "apple,iac20";
				reg= <0x11>;
				reset-gpio = <&gpio_s 11 0>;
			};
			/**
			 * Touch panel used in 7 inch LCD display from
			 * Multi-Inno Model NO. MI0700SAT3.
			 */
			ft5336: ft5336@38 {
				compatible = "focaltech,ft6236";
				reg = <0x38>;
				interrupt-parent = <&gpio1>;
				interrupts = <16 0>;
				reset-gpio = <&gpio_m3 15 1>;
				touchscreen-size-x = <800>;
				touchscreen-size-y = <480>;
				touchscreen-inverted-y;
			};
			/**
			 * Touch panel used in 10 inch LCD display from
			 * EVERVISION Model NO. VGG128004-5TSLWH.
			 */
			ft5x26: ft5x26@38 {
				status = "disabled";
				compatible = "edt,edt-ft5506";
				reg = <0x38>;
				interrupt-parent = <&gpio1>;
				interrupts = <16 0>;
				reset-gpio = <&gpio_m3 15 1>;
				touchscreen-size-x = <2048>;
				touchscreen-size-y = <2048>;
				touchscreen-swapped-x-y;
			};
			/**
			 * Touch panel used in 7 inch LCD display from
			 * Ampire Model AM-1280800P2TZQW-T01H.
			 */
			exc3132: exc3132@2a {
				status = "disabled";
				compatible = "ampire,exc3132";
				reg = <0x2a>;
				interrupt-parent = <&gpio1>;
				interrupts = <16 IRQ_TYPE_EDGE_FALLING>;
				reset-gpio = <&gpio_m3 15 1>;
			};
			hdmi0: adv7513@39 {
				status = "disabled";
				compatible = "adi,adv7513";
				reg = <0x39>;
				interrupt-parent = <&gpio1>;
				interrupts = <2 IRQ_TYPE_EDGE_FALLING>;

				adi,input-depth = <8>;
				adi,input-colorspace = "rgb";
				adi,input-clock = "1x";

				adi,edid-i2c-address = <0x3b>;
				adi,packet-i2c-address = <0x34>;
				adi,cec-i2c-address = <0x40>;

				ports {
					#address-cells = <1>;
					#size-cells = <0>;

					port@0 {
						reg = <0>;
						adv7513_in: endpoint {
							remote-endpoint = <&clcd_out_hdmi1>;
						};
					};

					port@1 {
						reg = <1>;
					};
				};
			};
		};

		i2c1: i2c@50040000 {
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&i2c1_default_mux>;
			pinctrl-1 = <&i2c1_default_mux>;
		};

		i2c2: i2c@50030000 {
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&i2c2_default_mux>;
			pinctrl-1 = <&i2c2_default_mux>;
			/* TDA7569 Audio Amplifier 0x6D */
			tda7569: tda7569@0x6d{
				compatible = "st,tda7569";
				codec-dai-name = "tda7569";
				reg = <0x6D>;
				gain = <26>;
				clip = <2>;
				sby-gpio = <&gpio_s 6 1>;
				};
			adv7182: adv7182@20 {
				status = "disabled";
				compatible = "adi,adv7182";
				interrupt-parent = <&gpio1>;
				interrupts = <5 IRQ_TYPE_LEVEL_LOW>;
				reg = <0x20>;
				port {
					adv7182_1: endpoint {
						bus-width = <8>;
						remote-endpoint = <&vip_0>;
						data-active = <1>;
						pclk-sample = <1>;
					};
				};
			};
		};

		msp0: msp@48000000 {
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&i2s0_default_mux>;
			pinctrl-1 = <&i2s0_default_mux>;
		};

		panel_rgb1: panel-rgb1 {
			compatible = "rocktech,rk070er9427-ct";

			port {
				panel_rgb1_in: panel-rgb1-in {
					remote-endpoint = <&clcd_out_rgb1>;
				};
			};
		};

		panel_rgb2: panel-rgb2 {
			status = "disabled";
			compatible = "rocktech,rk070er9427-ct";

			port {
				panel_rgb2_in: panel-rgb2-in {
					remote-endpoint = <&clcd_out_rgb2>;
				};
			};
		};

		qspi0: sqi@50200000 {
			status = "okay";
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&sqi_default_mux>;
			pinctrl-1 = <&sqi_default_mux>;

			flash0: serial-flash@0 {
				#address-cells = <1>;
				#size-cells = <1>;
				spi-max-frequency = <133000000>;
			};
		};

		rotary: rotary@0 {
			compatible = "rotary-encoder";
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&rotary_default_mode>;
			pinctrl-1 = <&rotary_default_mode>;
			gpios = <&gpio_s 8 1>, <&gpio_s 9 1>;
			linux,axis = <1>;
			rotary-encoder,relative-axis;
		};

		rproc {
			system_resources {
				tuner_i2c {
					compatible = "rproc-srm-sta-dev";
					st,shared-dev = <&i2c1>;
				};
			};
		};

		sai1: sai@48D08C00 {
			status = "disabled";
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&sai1_default_mux>;
			pinctrl-1 = <&sai1_default_mux>;
		};

		sai2: sai@48D08C04 {
			status = "disabled";
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&sai2_default_mux>;
			pinctrl-1 = <&sai2_default_mux>;
		};

		sai3: sai@48D08C08 {
			status = "disabled";
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&sai3_default_mux>;
			pinctrl-1 = <&sai3_default_mux>;
		};

		sai4: sai@48D08C0C {
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&sai4_default_mux>;
			pinctrl-1 = <&sai4_default_mux>;
		};

		sdi0: sdi@50080000 {
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&sdi0_default_mux>;
			pinctrl-1 = <&sdi0_default_mux>;
		};

		sdi1: sdi@50070000 {
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&sdi1_default_mux>;
			pinctrl-1 = <&sdi1_default_mux>;
			bus-width = <4>;
			max-frequency = <50000000>;
			st,sig-pin-fbclk;
			st,fbclk-inverted;
			cd-gpios = <&gpio_m3 4 0>;
			cd-inverted;
		};

		sdi2_pwrseq: sdi2_pwrseq {
			compatible = "mmc-pwrseq-simple";
			reset-gpios = <&gpio1 18 0>;
		};

		sdi2: sdi@500B0000 {
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&sdi2_default_mux>;
			pinctrl-1 = <&sdi2_default_mux>;
			max-frequency = <50000000>;
			st,sig-pin-fbclk;
			st,fbclk-inverted;
			broken-cd;
			mmc-pwrseq = <&sdi2_pwrseq>;
			/* disabled because in competition with the fsmc */
			status = "disabled";
		};

		/* Adds a codec dai for TDA7569 Audio Amp to soundcard3 */
		sound_card3 {
			st,cpu-name = "snd-soc-dummy", "snd-soc-dummy", "snd-soc-dummy";
			st,audio-codec = <&codec_aif &codec_dsp &tda7569>;
			st,codec-dai-name = "st-codec-aif", "st-codec-dsp", "tda7569";
		};

		spi0: spi@50170000 {
			status = "disabled";
		};

		spi1: spi@50060000 {
			status = "disabled";
		};

		spi2: spi@50050000 {
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&spi2_default_mux>;
			pinctrl-1 = <&spi2_default_mux>;
			num-cs = <1>;
			spidev@0 {
				compatible = "st,sta662";
				spi-max-frequency = <1000000>;
				reg = <0>;
				spi-cpol;
				spi-cpha;
				pl022,hierarchy = <0>;
				pl022,interface = <0>;
				pl022,duplex = <0>;
			};
		};

		sta-display-subsystem {
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&clcd_default_mux>;
			pinctrl-1 = <&clcd_default_mux>;
			clcd@48600000 {
				port {
					clcd_out_rgb1: clcd-out-rgb1 {
						remote-endpoint = <&panel_rgb1_in>;
					};
					clcd_out_rgb2: clcd-out-rgb2 {
						remote-endpoint = <&panel_rgb2_in>;
					};
					clcd_out_hdmi1: clcd-out-hdmi1 {
						remote-endpoint = <&adv7513_in>;
					};
				};
			};
		};

		tvdec: tvdec {
			compatible = "st,sta_tvdec";
			port {
				tvdec_1: endpoint {
					remote-endpoint = <&vip_0>;
				};
			};
		};

		uart0: uart@50150000 {
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&uart0_default_mux>;
			pinctrl-1 = <&uart0_default_mux>;
		};

		uart1: uart@50000000 {
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&uart1_default_mux>;
			pinctrl-1 = <&uart1_default_mux>;
		};

		uart2: uart@50010000 {
			status = "disabled";
		};

		uart3: uart@50020000 {
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&uart3_default_mux>;
			pinctrl-1 = <&uart3_default_mux>;
		};

		usb0: usb@48400000 {
			st,vbus_sensing_gadget;
			st,vbus_raw_limit = <0x300>;
			io-channels = <&saradc 4>;
		};

		usb1: usb@48500000 {
			st,vbus_sensing_gadget;
			st,vbus_raw_limit = <0x300>;
			io-channels = <&saradc 5>;
		};

		usbphy: usb-phy@48440000 {
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&drvvbus_default_mux>;
			pinctrl-1 = <&drvvbus_default_mux>;
			st,usb0_mode = "HOST";
			st,usb0_cdp;
			st,usb1_mode = "DEVICE";
			st,usb1_cdp;
		};

		vip: vip@48800000 {
			input = <0x2>;
			pinctrl-names = "default", "sleep";
			pinctrl-0 = <&vip_default_mux>;
			pinctrl-1 = <&vip_default_mux>;
			port {
				#address-cells = <1>;
				#size-cells = <0>;

				vip_0: endpoint {
					remote-endpoint = <&tvdec_1>;
					bus-width = <8>;
					data-active = <1>; /* Active high */
					pclk-sample = <1>; /* Rising */
				};
			};
		};

		pinctrl {
			can0 {
				can0_default_mux: can_mux {
					default_mux {
						function = "can0";
						groups = "can0_a_1";
					};
				};
			};
			can1 {
				can1_default_mux: can_mux {
					default_mux {
						function = "can1";
						groups = "can1_c_1";
					};
				};
			};
			can2 {
				can2_default_mux: can_mux {
					default_mux {
						function = "can2";
						groups = "can2_c_1";
					};
				};
			};
			clcd {
				clcd_default_mux: clcd_mux {
					default_mux {
						function = "clcd";
						groups = "clcd_a_1";
					};
				};
			};
			eft3 {
				eft3_default_mux: eft3_mux {
					default_mux {
						function = "eft3";
						groups = "eft3ocmp0_a_1";
					};
				};
			};
			eft4 {
				eft4_default_mux: eft_mux {
					default_mux {
						function = "eft4";
						groups = "eft4extck_c_1";
					};
				};
			};
			eth {
				eth_default_mux: eth_mux {
					default_mux {
						function = "eth";
						groups = "ethmdio_a_1",
							"ethmdc_a_1",
							"ethrmii_a_1",
							/* Rx Clock for RMII & RGMII */
							"ethmiirxclk_b_1",
							/* Tx Clock for RGMII */
							"ethmiitxclk_a_1",
							"ethmii_a_1";
					};
				};
			};
			fsmc {
				fsmc_default_mux: fsmc_mux {
					default_mux {
						function = "fsmc";
						groups = "fsmcsmadq0to7_a_1",
							"fsmcwpn_a_1",
							"fsmcbusy_a_1",
							"fsmcoen_a_1",
							"fsmcwen_a_1",
							"fsmcsmad17ale_a_1",
							"fsmcsmad16cle_a_1",
							"fsmcnandcs0n_a_1";
					};
				};
			};
			i2c0 {
				i2c0_default_mux: i2c_mux {
					default_mux {
						function = "i2c0";
						groups = "i2c0_a_2";
					};
				};
			};
			i2c1 {
				i2c1_default_mux: i2c_mux {
					default_mux {
						function = "i2c1";
						groups = "i2c1_a_1";
					};
				};
			};
			i2c2 {
				i2c2_default_mux: i2c_mux {
					default_mux {
						function = "i2c2";
						groups = "i2c2_a_1";
					};
				};
			};
			i2s0 {
				i2s0_default_mux: i2s_mux {
					default_mux {
						function = "i2s0";
						groups = "i2s0_a_1",
							"i2s0tx_a_1";
					};
				};
			};
			i2s2 {
				i2s2_default_mux: i2s_mux {
					default_mux {
						function = "i2s2";
						groups = "i2s2_c_1";
					};
				};
			};
			rotary {
				rotary_default_mode: rotary_default {
					default_cfg {
						pins = "GPIO136", "GPIO137";
						ste,config = <&in_nopull>;
					};
				};
			};
			sqi {
				sqi_default_mux: sqi_mux {
					default_mux {
						function = "sqi";
						groups = "sqi_a_1",
							"sqifdbsck_a_1";
					};
				};
			};
			sai1 {
				sai1_default_mux: sai_mux {
					default_mux {
						function = "sai1";
						groups = "sai1_a_1";
					};
				};
			};
			sai2 {
				sai2_default_mux: sai_mux {
					default_mux {
						function = "sai2";
						groups = "sai2_a_1";
					};
				};
			};
			sai3 {
				sai3_default_mux: sai_mux {
					default_mux {
						function = "sai3";
						groups = "sai3bclk_a_1",
						"sai3fs_a_1",
						"sai3rx0_a_1",
						"sai3rx1_a_1",
						"sai3rx2_a_1";
					};
				};
			};
			sai4 {
				sai4_default_mux: sai_mux {
					default_mux {
						function = "sai4";
						groups = "sai4bclk_c_1",
							"sai4fs_c_1",
							"sai4rx0_c_1",
							"sai4rx1_c_1";
					};
				};
			};
			sdi0 {
				sdi0_default_mux: sdi_mux {
					default_mux {
						function = "mc0";
						groups = "mc0fbclk_b_1";
					};
				};
			};
			sdi1 {
				sdi1_default_mux: sdi_mux {
					default_mux {
						function = "mc1";
						groups = "mc1cmd_a_1",
							"mc1clk_a_1",
							"mc1dat0_a_1",
							"mc1dat123_b_1",
							"mc1fbclk_c_1";
					};
					default_cfg {
						pins = "GPIO164";
						ste,config = <&in_pu>;
					};
				};
			};
			sdi2 {
				sdi2_default_mux: sdi_mux {
					default_mux {
						function = "mc2";
						groups = "mc2_b_1",
							"mc2data4to7_b_1",
							"mc2fbclk_b_1";
					};
				};
			};
			spi1 {
				spi1_default_mux: spi_mux {
					default_mux {
						function = "spi1";
						groups = "spi1_a_1";
						/* groups = "spi1ss_a_1",
							"spi1_a_1"; */
					};
				};
			};
			spi2 {
				spi2_default_mux: spi_mux {
					default_mux {
						function = "spi2";
						groups = "spi2_b_1";
						/* groups = "spi2ss_c_1",
							"spi2_b_1"; */
					};
				};
			};
			uart0 {
				uart0_default_mux: uart_mux {
					default_mux {
						function = "u0";
						groups = "u0rxtx_a_1",
							"u0rtscts_a_1";
					};
				};
			};
			uart1 {
				uart1_default_mux: uart_mux {
					default_mux {
						function = "u1";
						groups = "u1rxtx_b_1";
					};
					/*
					 *  Disable pull resistor of uart1 rx pin by default
					 *  as it may prevent initial handshake with some
					 *  remote device (like Teseo chip) to work properly.
					 */
					default_cfg {
						pins = "GPIO29";
						ste,config = <&in_nopull>;
					};
				};
			};
			uart3 {
				uart3_default_mux: uart_mux {
					default_mux {
						function = "u3";
						groups = "u3rxtx_a_1";
					};
				};
			};
			usbphy {
				drvvbus_default_mux: drvvbus_default_mux {
					default_mux {
						function = "usb";
						groups = "usb0drvvbus_b_1",
							 "usb1drvvbus_c_1";
					};
				};
			};
			vip {
				vip_default_mux: vip_mux {
					default_mux {
						function = "vip";
						groups = "vip_a_1";
					};
				};
			};
			wdg {
				wdg_default_mux: wdg_mux {
					default_mux {
						function = "wdg";
						groups = "wdgswrstout_a_1";
					};
				};
			};
		};
	};
};
