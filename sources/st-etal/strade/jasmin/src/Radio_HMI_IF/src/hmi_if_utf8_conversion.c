/*=============================================================================
    start of file
=============================================================================*/
/************************************************************************************************************/
/** \file hmi_if_utf8_conversion.c
* Copyright (c) 2016, Jasmin Infotech Private Limited.
*  All rights reserved. Reproduction in whole or part is prohibited
*  without the written permission of the copyright owner.
*
*  Project              : ST_Radio_Middleware
*  Organization			: Jasmin Infotech Pvt. Ltd.
*  Module				: HMI IF
*  Description			: This file contains all the function definitions for UTF8 conversion functions
*
*
**********************************************************************************************************/
/*-----------------------------------------------------------------------------
    includes
-----------------------------------------------------------------------------*/
#include<string.h>
#include "hmi_if_utf8_conversion.h"

HMI_IF_EBU_CHARSET ast_EBUMapping[256] =
{
	{ 0x00, 0x0000 },
	{ 0x01, 0x0001 },
	{ 0x02, 0x0002 },
	{ 0x03, 0x0003 },
	{ 0x04, 0x0004 },
	{ 0x05, 0x0005 },
	{ 0x06, 0x0006 },
	{ 0x07, 0x0007 },
	{ 0x08, 0x0008 },
	{ 0x09, 0x0009 },
	{ 0x0A, 0x000A },
	{ 0x0B, 0x000B },
	{ 0x0C, 0x000C },
	{ 0x0D, 0x000D },
	{ 0x0E, 0x000E },
	{ 0x0F, 0x000F },

	{ 0x10, 0x0010 },
	{ 0x11, 0x0011 },
	{ 0x12, 0x0012 },
	{ 0x13, 0x0013 },
	{ 0x14, 0x0014 },
	{ 0x15, 0x0015 },
	{ 0x16, 0x0016 },
	{ 0x17, 0x0017 },
	{ 0x18, 0x0018 },
	{ 0x19, 0x0019 },
	{ 0x1A, 0x001A },
	{ 0x1B, 0x001B },
	{ 0x1C, 0x001C },
	{ 0x1D, 0x001D },
	{ 0x1E, 0x001E },
	{ 0x1F, 0x001F },

	{ 0x20, 0x0020 },
	{ 0x21, 0x0021 },
	{ 0x22, 0x0022 },
	{ 0x23, 0x0023 },
	{ 0x24, 0xC2A4 },
	{ 0x25, 0x0025 },
	{ 0x26, 0x0026 },
	{ 0x27, 0x0027 },
	{ 0x28, 0x0028 },
	{ 0x29, 0x0029 },
	{ 0x2A, 0x002A },
	{ 0x2B, 0x002B },
	{ 0x2C, 0x002C },
	{ 0x2D, 0x002D },
	{ 0x2E, 0x002E },
	{ 0x2F, 0x002F },

	{ 0x30, 0x0030 },
	{ 0x31, 0x0031 },
	{ 0x32, 0x0032 },
	{ 0x33, 0x0033 },
	{ 0x34, 0x0034 },
	{ 0x35, 0x0035 },
	{ 0x36, 0x0036 },
	{ 0x37, 0x0037 },
	{ 0x38, 0x0038 },
	{ 0x39, 0x0039 },
	{ 0x3A, 0x003A },
	{ 0x3B, 0x003B },
	{ 0x3C, 0x003C },
	{ 0x3D, 0x003D },
	{ 0x3E, 0x003E },
	{ 0x3F, 0x003F },

	{ 0x40, 0x0040 },
	{ 0x41, 0x0041 },
	{ 0x42, 0x0042 },
	{ 0x43, 0x0043 },
	{ 0x44, 0x0044 },
	{ 0x45, 0x0045 },
	{ 0x46, 0x0046 },
	{ 0x47, 0x0047 },
	{ 0x48, 0x0048 },
	{ 0x49, 0x0049 },
	{ 0x4A, 0x004A },
	{ 0x4B, 0x004B },
	{ 0x4C, 0x004C },
	{ 0x4D, 0x004D },
	{ 0x4E, 0x004E },
	{ 0x4F, 0x004F },

	{ 0x50, 0x0050 },
	{ 0x51, 0x0051 },
	{ 0x52, 0x0052 },
	{ 0x53, 0x0053 },
	{ 0x54, 0x0054 },
	{ 0x55, 0x0055 },
	{ 0x56, 0x0056 },
	{ 0x57, 0x0057 },
	{ 0x58, 0x0058 },
	{ 0x59, 0x0059 },
	{ 0x5A, 0x005A },
	{ 0x5B, 0x005B },
	{ 0x5C, 0x005C },
	{ 0x5D, 0x005D },
	{ 0x5E, 0x005E },
	{ 0x5F, 0x005F },

	{ 0x60, 0x0060 },
	{ 0x61, 0x0061 },
	{ 0x62, 0x0062 },
	{ 0x63, 0x0063 },
	{ 0x64, 0x0064 },
	{ 0x65, 0x0065 },
	{ 0x66, 0x0066 },
	{ 0x67, 0x0067 },
	{ 0x68, 0x0068 },
	{ 0x69, 0x0069 },
	{ 0x6A, 0x006A },
	{ 0x6B, 0x006B },
	{ 0x6C, 0x006C },
	{ 0x6D, 0x006D },
	{ 0x6E, 0x006E },
	{ 0x6F, 0x006F },

	{ 0x70, 0x0070 },
	{ 0x71, 0x0071 },
	{ 0x72, 0x0072 },
	{ 0x73, 0x0073 },
	{ 0x74, 0x0074 },
	{ 0x75, 0x0075 },
	{ 0x76, 0x0076 },
	{ 0x77, 0x0077 },
	{ 0x78, 0x0078 },
	{ 0x79, 0x0079 },
	{ 0x7A, 0x007A },
	{ 0x7B, 0x007B },
	{ 0x7C, 0x007C },
	{ 0x7D, 0x007D },
	{ 0x7E, 0x007E },
	{ 0x7F, 0x007F },

	{ 0x80, 0xC3A1 },
	{ 0x81, 0xC3A0 },
	{ 0x82, 0xC3A9 },
	{ 0x83, 0xC3A8 },
	{ 0x84, 0xC3AD },
	{ 0x85, 0xC3AC },
	{ 0x86, 0xC3B3 },
	{ 0x87, 0xC3B2 },
	{ 0x88, 0xC3BA },
	{ 0x89, 0xC3B9 },
	{ 0x8A, 0xC391 },
	{ 0x8B, 0xC387 },
	{ 0x8C, 0xC59E },
	{ 0x8D, 0xC39F },
	{ 0x8E, 0xC2A1 },
	{ 0x8F, 0xC4B2 },

	{ 0x90, 0xC3A2 },
	{ 0x91, 0xC3A2 },
	{ 0x92, 0xC3AA },
	{ 0x93, 0xC3AB },
	{ 0x94, 0xC3AE },
	{ 0x95, 0xC3AF },
	{ 0x96, 0xC3B4 },
	{ 0x97, 0xC3B6 },
	{ 0x98, 0xC3BB },
	{ 0x99, 0xC3BC },
	{ 0x9A, 0xC3B1 },
	{ 0x9B, 0xC3A7 },
	{ 0x9C, 0xC59F },
	{ 0x9D, 0xC7A7 },
	{ 0x9E, 0xC4B1 },
	{ 0x9F, 0xC4B3 },

	{ 0xA0, 0xC2AA },
	{ 0xA1, 0xCEB1 },
	{ 0xA2, 0xC2A9 },
	{ 0xA3, 0xE280B0 },
	{ 0xA4, 0xC49E },
	{ 0xA5, 0xC49B },
	{ 0xA6, 0xC588 },
	{ 0xA7, 0xC591 },
	{ 0xA8, 0xCF80 },
	{ 0xA9, 0xE282A0 },
	{ 0xAA, 0xC2A3 },
	{ 0xAB, 0x0024 },
	{ 0xAC, 0xE28690 },
	{ 0xAD, 0xE28691 },
	{ 0xAE, 0xE28692 },
	{ 0xAF, 0xE28693 },

	{ 0xB0, 0xC2BA },
	{ 0xB1, 0xC2B9 },
	{ 0xB2, 0xC2B2 },
	{ 0xB3, 0xC2B3 },
	{ 0xB4, 0xC2B1 },
	{ 0xB5, 0xC4B0 },
	{ 0xB6, 0xC584 },
	{ 0xB7, 0xC5B1 },
	{ 0xB8, 0xC2B5 },
	{ 0xB9, 0xC2BF },
	{ 0xBA, 0xC3B7 },
	{ 0xBB, 0xC2B0 },
	{ 0xBC, 0xC2BC },
	{ 0xBD, 0xC2BD },
	{ 0xBE, 0xC2BE },
	{ 0xBF, 0xC2A7 },

	{ 0xC0, 0xC381 },
	{ 0xC1, 0xC380 },
	{ 0xC2, 0xC389 },
	{ 0xC3, 0xC388 },
	{ 0xC4, 0xC38D },
	{ 0xC5, 0xC38C },
	{ 0xC6, 0xC393 },
	{ 0xC7, 0xC392 },
	{ 0xC8, 0xC39A },
	{ 0xC9, 0xC399 },
	{ 0xCA, 0xC598 },
	{ 0xCB, 0xC48C },
	{ 0xCC, 0xC5A0 },
	{ 0xCD, 0xC5BD },
	{ 0xCE, 0xC490 },
	{ 0xCF, 0xC4BF },

	{ 0xD0, 0xC382 },
	{ 0xD1, 0xC384 },
	{ 0xD2, 0xC38A },
	{ 0xD3, 0xC38B },
	{ 0xD4, 0xC38E },
	{ 0xD5, 0xC38F },
	{ 0xD6, 0xC394 },
	{ 0xD7, 0xC396 },
	{ 0xD8, 0xC39B },
	{ 0xD9, 0xC39C },
	{ 0xDA, 0xC599 },
	{ 0xDB, 0xC48D },
	{ 0xDC, 0xC5A1 },
	{ 0xDD, 0xC5BE },
	{ 0xDE, 0xC491 },
	{ 0xDF, 0xC580 },

	{ 0xE0, 0xC383 },
	{ 0xE1, 0xC385 },
	{ 0xE2, 0xC386 },
	{ 0xE3, 0xC592 },
	{ 0xE4, 0xC5B7 },
	{ 0xE5, 0xC39D },
	{ 0xE6, 0xC395 },
	{ 0xE7, 0xC398 },
	{ 0xE8, 0xC39E },
	{ 0xE9, 0xC58A },
	{ 0xEA, 0xC594 },
	{ 0xEB, 0xC486 },
	{ 0xEC, 0xC59A },
	{ 0xED, 0xC5B9 },
	{ 0xEE, 0xC5A6 },
	{ 0xEF, 0xC3B0 },

	{ 0xF0, 0xC3A3 },
	{ 0xF1, 0xC3A5 },
	{ 0xF2, 0xC3A6 },
	{ 0xF3, 0xC593 },
	{ 0xF4, 0xC5B5 },
	{ 0xF5, 0xC3BD },
	{ 0xF6, 0xC3B5 },
	{ 0xF7, 0xC3B8 },
	{ 0xF8, 0xC3BE },
	{ 0xF9, 0xC58B },
	{ 0xFA, 0xC595 },
	{ 0xFB, 0xC487 },
	{ 0xFC, 0xC59B },
	{ 0xFD, 0xC5BA },
	{ 0xFE, 0xC5A7 },
	{ 0xFF, 0x0000 },
};


void HMI_IF_EBU_to_UTF8(Tu8 *au8_EBU_Data,Tu8 *au8_UTF8_Data,Tu16 u16_EBU_size, Tu16 u16_UTF8_size)
{
	//static Tu8 au8_UTF8_Data[(MAX_DLS_SIZE*3)+1];
	Tu8 i,j;
	Tu32 u32_UTF8,u32_Temp_UTF8 ;
	memset(au8_UTF8_Data, 0, u16_UTF8_size);
	j=0;
	for (i = 0; i< u16_EBU_size; i++)
	{

		if (au8_EBU_Data[i] >= 0x80)
		{
			if (au8_EBU_Data[i] == 0xA3 || au8_EBU_Data[i] == 0xA9 || au8_EBU_Data[i] == 0xAC ||au8_EBU_Data[i] == 0xAD || au8_EBU_Data[i] == 0xAE || au8_EBU_Data[i] == 0xAF)
			{
				u32_UTF8 = ast_EBUMapping[au8_EBU_Data[i]].u32_UTF8;

				au8_UTF8_Data[j] =(Tu8)( u32_UTF8 / 65536);
				j++;

				u32_Temp_UTF8 = u32_UTF8 % 65536;
				au8_UTF8_Data[j] = (Tu8)(u32_Temp_UTF8 / 256);
				j++;

				au8_UTF8_Data[j] = (Tu8)(u32_UTF8 % 256);
				j++;
			}
			else
			{
				u32_UTF8 = ast_EBUMapping[au8_EBU_Data[i]].u32_UTF8;
				au8_UTF8_Data[j] = (Tu8)(u32_UTF8 / 256);
				j++;
				au8_UTF8_Data[j] = (Tu8)(u32_UTF8 % 256);
				j++;

			}
		}
		else
		{
			if(au8_EBU_Data[i]==0x0B)
			{
				au8_UTF8_Data[j] = 0x3A;   /* End of Headline indicated with colon */
				j++;
			}
			else
			{
				au8_UTF8_Data[j] = au8_EBU_Data[i] ;
				j++;
			}
		}
	}
	// au8_UTF8_Data[j]= '\0';
	//return(au8_UTF8_Data);
}



void HMI_IF_UCS2_to_UTF8 (Tu8 *u8_LabelString,Tu8 *utf8,Tu16 u16_size)
{
	Tu8 u8_ucsLabelIndex=0;
	Tu8 u8_arrIndex=0;
    int s32_ucsValue=0;

	while(u8_ucsLabelIndex <= u16_size-4)
	{
		s32_ucsValue=(int)(((u8_LabelString[u8_ucsLabelIndex] & 0x000000FF)<<24)|((u8_LabelString[u8_ucsLabelIndex+1]& 0x000000FF)<<16)
		|((u8_LabelString[u8_ucsLabelIndex+2]&0x000000FF)<<8)|(u8_LabelString[u8_ucsLabelIndex+3]&0x000000FF));
		
		u8_ucsLabelIndex=u8_ucsLabelIndex+4;

		if (s32_ucsValue < 0x80)
		{
			utf8[u8_arrIndex++] = s32_ucsValue;
			//utf8[1] = '\0';
			//return 1;
		}
		else if (s32_ucsValue>= 0x80  && s32_ucsValue < 0x800)
		{
			utf8[u8_arrIndex++] = (s32_ucsValue >> 6)   | 0xC0;
			utf8[u8_arrIndex++] = (s32_ucsValue & 0x3F) | 0x80;
			//  utf8[2] = '\0';
			//return 2;
		}
		else if (s32_ucsValue >= 0x800 && s32_ucsValue < 0xFFFF)
		{
			if (s32_ucsValue >= 0xD800 && s32_ucsValue <= 0xDFFF)
			{
				/* Ill-formed. */
				//return 0;
				// return UNICODE_SURROGATE_PAIR;
			}
			utf8[u8_arrIndex++] = ((s32_ucsValue >> 12)       ) | 0xE0;
			utf8[u8_arrIndex++] = ((s32_ucsValue >> 6 ) & 0x3F) | 0x80;
			utf8[u8_arrIndex++] = ((s32_ucsValue      ) & 0x3F) | 0x80;
			//utf8[3] = '\0';
			//return 3;
		}
		else if (s32_ucsValue >= 0x10000 && s32_ucsValue < 0x10FFFF)
		{
			utf8[u8_arrIndex++] = 0xF0 | (s32_ucsValue >> 18);
			utf8[u8_arrIndex++] = 0x80 | ((s32_ucsValue >> 12) & 0x3F);
			utf8[u8_arrIndex++] = 0x80 | ((s32_ucsValue >> 6) & 0x3F);
			utf8[u8_arrIndex++] = 0x80 | ((s32_ucsValue & 0x3F));

			//return 4;
		}
	}
	utf8[u8_arrIndex] = '\0';
}